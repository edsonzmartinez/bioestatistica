#################
# Aula 2        #
#################

# Leverage

x <- c(7.00174712948254, 3.42781031589392, 8.52105574282553, 4.12482912275715, 
8.37374758810425, 3.95369048270609, 7.09002403256177, 4.82472651051348, 
6.94010595204472, 4.84546519467089, 6.56439343084678, 4.44376140143253, 
8.65555062767845, 6.76478415569091, 2.90705815680475, 7.49991575223246, 
7.00213557519635, 6.05062262451397, 3.09376280117596, 3.23544938540961, 
6.80602406252237, 9.88790217314452, 0.690038585165681, 2.8886316831934, 
5.07872014368443, 3.93326938806275, 3.146347513878, 8.04235488064743, 
4.11659556160699, 4.51723274570686, -0.392876906074164, 3.38443748315666, 
3.26484518200147, 3.88873909943655, 3.39831572607608, 8.87863239949017, 
5.67766596198024, 6.76774552247464, 2.71492895277715, 5.7121991798231, 
5.33799523062086, 7.84112966563011, 10.4588254431617, 3.4506003231019, 
2.10139072411213, 3.97703412699872, 5.93059512790795, 5.7855190078502, 
5.76843964898612, 3.97276412774644, 4.39378535386709, 5.71640013634206, 
5.51340860749047, 4.5907303701762, 3.31008330029527, 9.32916930487116, 
3.71078787243564, 2.36439662231077, 4.20420154312883, 5.21420984755441, 
5.77519954482952, 1.64232584659987, 2.12080793690511, 3.92501584522754, 
5.13920133760774, 6.69105891707917, 7.52719374690774, 1.89221896791134, 
3.16029383465529, 5.31213716765184, 4.99408755014427, 3.59404259765348, 
5.35055960522695, 6.05885704546737, 7.11307379323143, 3.91713016193117, 
3.77462654532407, 1.31028715967763, 7.97644275299941, 6.98384138151947, 
4.39460300867419, 4.65949615933869, 6.06704629376181, 6.04955685577203, 
6.00337417806602, 4.46991651945873, 3.978041809596, 8.48068509644628, 
6.06703027887744, 6.35993994983707, 4.6027434489403, 4.31774354661981, 
2.69200338854798, 3.04830481309809, 5.44009375746166, 2.08777723421555, 
3.33914125640455, 9.4980649547125, 7.67331591401228, 2.78648282012637, 10)

y <- c(7.18757125485541, 15.7583171747943, 13.8054500713669, 9.67102446757093, 
9.45869751601116, 12.4442640702196, 10.635998788434, 17.2414202706205, 
9.86971530266937, 7.1244686017249, 10.9045946693933, 14.5779123842152, 
15.2812127720382, 8.97613942966552, 17.4710976958648, 10.8131878127853, 
10.5425380915134, 7.00879083536761, 5.59012114286317, 7.03835228419343, 
13.2301976869436, 16.3810105654493, 12.4430038423371, 7.89138432385461, 
11.9137222488805, 17.2033330029129, 9.87524717424288, 11.6218611620329, 
18.1816633750854, 2.57542898202939, 10.4720889563575, 14.959473641122, 
6.07268160577814, 11.7556840097281, 11.7043157949436, 13.0834075143326, 
7.60620700565468, 14.7433422212012, 7.31839885433726, 13.5764056160014, 
12.4733630565169, 14.0026278906154, 13.8134881955219, 11.3461268792287, 
16.3575274332158, 17.7625797990145, 16.2079662408937, 7.08307850595622, 
17.5466204649117, 14.8078687504493, 9.21592339236405, 8.45673763952783, 
9.45288527602863, 11.8415222924217, 10.417112007983, 10.3135943923442, 
9.30940800456943, 7.94560988620789, 12.5178696379242, 4.27445498987508, 
14.0775920463786, 7.14015906704605, 11.6274937764255, 13.6170027494992, 
9.06470466420889, 7.78808814343803, 10.7801265320517, 7.73533327109074, 
11.5866184460959, 7.08770071475279, 13.2958558478651, 9.66392698812927, 
8.73435249790248, 11.966430863254, 6.61943056031116, 2.96575022008354, 
13.0505881506843, 8.65426083865582, 12.4793500364089, 6.76614565835074, 
5.2922086305817, 8.4450056777774, 12.2294058014436, 15.8223956552243, 
15.5766819459155, 14.3878040034365, 9.44165947724122, 10.2938507440163, 
8.9920539812653, 13.6284775573068, 13.3995237313451, 5.79369673057994, 
5.86912059380556, 10.3525260563245, 15.5043075691772, 2.70667086786833, 
16.2401508667509, 11.0109463752221, 9.60739533531043, 10.241706156151, 50)

# Gráfico
plot(x,y,las=1,pch=19,bty="l")

# Matriz X
n <- length(x)
X <- matrix(c(rep(1,n),x),ncol=2)

# Coeficientes
solve(t(X)%*%X)%*%t(X)%*%y

# Modelo 1: todas as observações
m1 <- lm(y~x)
summary(m1)
plot(x,y,las=1,pch=19,bty="l")
abline(m1,col="red",lwd=2)

# Modelo 2: sem a observação #101
m2 <- lm(y[-101]~x2[-101])
summary(m2)
plot(x,y,las=1,pch=19,bty="l")
abline(m1,col="red",lwd=2)
abline(m2,col="blue",lwd=2)
text(x[101],y[101],"101",pos=1)

# Leverage
plot(hatvalues(m1), type = 'h', las=1, col="red")
h <- hatvalues(m1)
# A soma dos valores de h é o número de parâmetros do modelo
sum(h)

# Flag
# A common rule is to flag any observation whose leverage value
# is more than 3 times larger than the mean leverage value
flag <- 3*sum(h)/n
plot(hatvalues(m1), type = 'h', las=1, col="red")
lines(c(0,n+1),c(flag,flag),lty="dashed")
paste("Flagged observations:")
which(as.numeric(h)>flag)

# Gráfico
plot(x,y,las=1,pch=19,bty="l")
text(x[31],y[31],"31",pos=1,col="red")
text(x[43],y[43],"43",pos=1,col="red")
text(x[101],y[101],"101",pos=1,col="red")

